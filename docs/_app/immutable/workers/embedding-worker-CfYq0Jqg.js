var d=Object.defineProperty;var m=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var n=(e,t,s)=>m(e,typeof t!="symbol"?t+"":t,s);import{env as i,pipeline as p}from"https://cdn.jsdelivr.net/npm/@xenova/transformers@2.5.0/dist/transformers.js";const y="Xenova/all-MiniLM-L6-v2",f="feature-extraction";i.allowLocalModels=!1;i.backends.onnx.wasm.numThreads=1;class a{static async getInstance(t=null){return this.instance===null&&(this.instance=p(this.task,this.model,{progress_callback:t})),this.instance}}n(a,"task",f),n(a,"model",y),n(a,"instance",null);self.onmessage=async e=>{const{type:t,text:s,id:o}=e.data;if(t==="embed")try{const r=await(await a.getInstance())(s,{pooling:"mean",normalize:!0}),l={data:r.data,dims:r.dims,type:r.type};self.postMessage({type:"complete",id:o,embedding:l})}catch(c){self.postMessage({type:"error",id:o,error:c.message})}};(async()=>{try{await a.getInstance(e=>{}),self.postMessage({type:"ready"})}catch(e){self.postMessage({type:"error",error:e.message})}})();

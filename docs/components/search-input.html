<div class="search-container">
  <input type="text" 
         id="search-input" 
         placeholder="Enter search query..."
         aria-label="Semantic search query"
         onkeydown="if(event.key === 'Enter') document.getElementById('search-button').click()">
  <button id="search-button">Search</button>
</div>

<script>
async function handleSearch() {
  if (!this._pipeline) {
    this._pipeline = await transformers.pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2');
  }
  const query = document.getElementById('search-input').value.trim();
  if (!query) return;

  const button = this;
  button.disabled = true;
  button.textContent = 'Processing...';

  try {
    // Generate embedding using cached pipeline
    const output = await this._pipeline(query, {
      pooling: 'mean',
      normalize: true,
      progress_callback: (progress) => {
        console.log(`Progress: ${Math.round(progress.loaded/progress.total * 100)}%`);
      }
    });
    
    // Convert to array and display formatted results
    const embedding = Array.from(output.data);
    const resultsDiv = document.getElementById('results-container');
    resultsDiv.innerHTML = `
      <h3>Generated embedding (${embedding.length} dimensions):</h3>
      <div class="embedding-values">${embedding.slice(0,10).map(v => v.toFixed(4)).join(', ')}...</div>
      <div class="embedding-meta">
        Min: ${Math.min(...embedding).toFixed(4)}, 
        Max: ${Math.max(...embedding).toFixed(4)},
        Avg: ${(embedding.reduce((a,b) => a + b, 0)/embedding.length).toFixed(4)}
      </div>
      <pre class="debug">${JSON.stringify({query, embedding: embedding.slice(0,5)}, null, 2)}</pre>
    `;
    
  } catch (error) {
    console.error('Embedding failed:', error);
    document.getElementById('results-container').innerHTML = 
      `<div class="error">Failed to generate embedding: ${error.message}</div>`;
  } finally {
    button.disabled = false;
    button.textContent = 'Search';
  }
}

document.getElementById('search-button').addEventListener('click', handleSearch);
</script>

<style>
.search-container {
  margin: 2rem 0;
  display: flex;
  gap: 0.5rem;
}

#search-input {
  flex-grow: 1;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
}

#search-button {
  padding: 0.5rem 1rem;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

#search-button:hover {
  background: #0069d9;
}
</style>

<div class="search-container">
  <input type="text" 
         id="search-input" 
         placeholder="Enter search query..."
         aria-label="Semantic search query"
         onkeydown="if(event.key === 'Enter') document.getElementById('search-button').click()">
  <button id="search-button">Search</button>
</div>

<script>
async function handleSearch() {
  // Ensure transformers is loaded - may take a moment on first load
  if (typeof transformers === 'undefined') {
    await new Promise(resolve => {
      const check = () => {
        if (typeof transformers !== 'undefined') return resolve();
        setTimeout(check, 100);
      };
      check();
    });
  }
  const query = document.getElementById('search-input').value.trim();
  if (!query) return;

  const button = this;
  button.disabled = true;
  button.textContent = 'Processing...';

  try {
    // Generate embedding using the already imported pipeline
    const output = await transformers.pipeline(
      'feature-extraction',
      'Xenova/all-MiniLM-L6-v2'
    )(query, {
      pooling: 'mean',
      normalize: true
    });
    
    // Convert to array and display formatted results
    const embedding = Array.from(output.data);
    const resultsDiv = document.getElementById('results-container');
    resultsDiv.innerHTML = `
      <h3>Generated embedding (${embedding.length} dimensions):</h3>
      <div class="embedding-values">${embedding.slice(0,10).map(v => v.toFixed(4)).join(', ')}...</div>
      <div class="embedding-meta">
        Min: ${Math.min(...embedding).toFixed(4)}, 
        Max: ${Math.max(...embedding).toFixed(4)},
        Avg: ${(embedding.reduce((a,b) => a + b, 0)/embedding.length).toFixed(4)}
      </div>
    `;
    
  } catch (error) {
    console.error('Embedding failed:', error);
    alert('Failed to generate embedding. Check console for details.');
  } finally {
    button.disabled = false;
    button.textContent = 'Search';
  }
}

document.getElementById('search-button').addEventListener('click', handleSearch);
</script>

<style>
.search-container {
  margin: 2rem 0;
  display: flex;
  gap: 0.5rem;
}

#search-input {
  flex-grow: 1;
  padding: 0.5rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 1rem;
}

#search-button {
  padding: 0.5rem 1rem;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
}

#search-button:hover {
  background: #0069d9;
}
</style>
